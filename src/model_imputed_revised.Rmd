---
title: "IBQ Machnine Learning Supplemental 2023"
authors: "Masha Gartstein, Erich Seamon"
date: "10/25/2022"
subtitle: 'The material contained herein is supplementary to the article named in the title and submitted to the journal, XXX.' 
always_allow_html: yes
header-includes:
- \usepackage{pdflscape}
- \newcommand{\blandscape}{\begin{landscape}}
- \newcommand{\elandscape}{\end{landscape}}
- \usepackage{setspace}\doublespacing
- \renewcommand{\figurename}{Figure S}
- \renewcommand{\tablename}{Table S}
output:
  pdf_document: default
  html_document:
    css: custom.css
    code_folding: hide
    highlight: textmate
    theme: united
    toc: true
    toc_float: true
params: null
mainfont: serif
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, fig.align = "center", fig.width=16, fig.height=8.5, dpi=400, dev = "cairo_pdf")
knitr::opts_knit$set(root.dir = "/mnt/ceph/erichs/git/IBQ_R_2022/", warning = FALSE, message = FALSE)  # with something else than `getwd()`

usePackage <- function(p) {
    if (!is.element(p, installed.packages()[,1]))
        install.packages(p, dep = TRUE, repos = "http://cran.us.r-project.org")
    require(p, character.only = TRUE)
}
usePackage("extrafont")
usePackage("ggplot2")
usePackage("webshot")
#webshot::install_phantomjs()
loadfonts()
```

This supplemental appendix provides exploratory data and factor analyses of agricultural insurance loss for the Pacific Northwest (PNW) and the inland Pacific Northwest (iPNW) of the United States.

\newpage

## Supplemental Figure and Tables List

### Itemized Models

Figure S1: Accuracy Estimates: Chronological Age Group vs. Pre-Term Group - ALL VARIABLES

Figure S2: Receiver Operator Curve: Chronological Age Group vs. Pre-Term Group - ALL VARIABLES

Figure S3: Accuracy Estimates: Age Adjusted Group vs. Pre-Term Group - ALL VARIABLES

Figure S4: Receiver Operator Curve: Age Adjusted Group vs. Pre-Term Group - ALL VARIABLES

### Transformed Feature Models

Figure S5: Accuracy Estimates: Chronological Age Group vs. Pre-Term Group - TRANSFORMED VARIABLES

Figure S6: Receiver Operator Curve: Chronological Age Group vs. Pre-Term Group - TRANSFORMED VARIABLES

Figure S7: Accuracy Estimates: Age Adjusted Group vs. Pre-Term Group - TRANSFORMED VARIABLES

Figure S8: Receiver Operator Curve: Age Adjusted Group vs. Pre-Term Group - TRANSFORMED VARIABLES

### Feature Importance Graphs

Figure S9: Feature Importance: Chronological Age Group vs. Pre-Term Group - ALL VARIABLES

Figure S10: Feature Importance: Age Adjusted Group vs. Pre-Term Group - ALL VARIABLES

Figure S11: Feature Importance: Chronological Age Group vs. Pre-Term Group - TRANSFORMED VARIABLES

Figure S12: Feature Importance: Age Adjusted Group vs. Pre-Term Group - TRANSFORMED VARIABLES

### Model Results Tables

Table S1: Model Results: ALL VARIABLES

Table S2: Model Results: TRANSFORMED VARIABLES

### Model Comparisons

Figure S13: R2 Comparisons - Chronological Age Group VS Pre-Term Group, Transformed Variables VS. All Variables

Figure S14: AUC Comparisons - Chronological Age Group VS Pre-Term Group, Transformed Variables VS. All Variables

Figure S15: R2 Comparisons - Age Adjusted Group VS Pre-Term Group, Transformed Variables VS. All Variables

Figure S16: AUC Comparisons - Age Adjusted Group VS Pre-Term Group, Transformed Variables VS. All Variables

```{r, results='hide', echo=FALSE, warning = FALSE, message = FALSE, error=FALSE, fig.width = 10.5, fig.height = 7.5}

library(dplyr)
library(lubridate)
library(tidyr)
library(data.table)
library(caret)
library(doParallel)
library(plyr)
library(mice)
library(VIM)

#ibq <- read.csv("./data/IBQ-R VSF Preterm 91022.csv")

set.seed(999)
ibq <- read.csv("./data/IBQ-R VSF Preterms Sept23.csv")
ibq[ibq == -99999] <- NA
ibq[ibq == 100] <- NA

#ibq[8:45] <- lapply(ibq[8:45], factor)  ## as.factor() could also be used

#ibq_mice <- md.pattern(ibq[8:45])
#aggr_plot <- aggr(ibq[8:45], col=c('navyblue','red'), numbers=TRUE, sortVars=TRUE, labels=names(ibq[8:45]), cex.axis=.7, gap=3, ylab=c("Histogram of missing data","Pattern"))

tempData <- mice(ibq[8:44],m=5,maxit=5,meth='pmm',seed=500)
ibq_impute <- complete(tempData,5)

ibq_impute <- cbind(ibq[1:7], ibq_impute, ibq[46:48])

ibq_impute$na <- rowMeans(ibq_impute[c(10,11,16,17,23,24,29,30,35,36,39,40)])
ibq_impute$sur <- rowMeans(ibq_impute[c(8,9,14,15,20,21,22,27,28,33,34,43,44)])
ibq_impute$ec <- rowMeans(ibq_impute[c(12,13,18,19,25,26,31,32,37,38,41,42)])

```

```{r, echo=FALSE, warning = FALSE, message = FALSE, error=FALSE, fig.width = 10.5, fig.height = 7.5}

#aggr_plot <- aggr(tempData$data, col=c('navyblue','red'), numbers=TRUE, sortVars=TRUE, labels=names(tempData$data), cex.axis=.7, gap=3, ylab=c("Histogram of missing data","Pattern"))

#densityplot(tempData)
#EDA


# bwplot(researcher ~ sur, data = ibq_impute)
# bwplot(researcher ~ na, data = ibq_impute)
# bwplot(researcher ~ ec, data = ibq_impute)
# 
# bwplot(infantrace ~ sur, data = ibq_impute)
# bwplot(infantrace ~ na, data = ibq_impute)
# bwplot(infantrace ~ ec, data = ibq_impute)
# 
# bwplot(infantgender ~ sur, data = ibq_impute)
# bwplot(infantgender ~ na, data = ibq_impute)
# bwplot(infantgender ~ ec, data = ibq_impute)

```

\newpage

## Model Development and Output: Chronological Age Group VS. Pre-Term Group - ALL VARIABLES

```{r, echo=FALSE, warning = FALSE, message = FALSE, error=FALSE, fig.width = 11, fig.height = 7.5, fig.cap=paste("Accuracy Estimates: Chronological Age Group vs. Pre-Term Group - All Variables.")}

set.seed(9999)
library(haven)
library(klaR)
#Infant gender model construction

ibq <- ibq_impute

ibq$group <- as.factor(ibq$group)
ibq$group <- revalue(ibq$group, c("0"="experimental", "1"="control_one", "2"="control_two"))

ibq <- ibq[ibq$group != "control_two",]
ibq$group <- factor(ibq$group)
ibq$group <- relevel(ibq$group, "control_one")

#ibq <- subset(ibq, AgeGrp == "three")

# ibq$infantgender <- as.factor(ibq$infantgender)
# levels(ibq$infantgender) <- c('male', 'female')

set.seed(103)
inTraining <- createDataPartition(ibq$group, p = .7, list = FALSE)
training <- ibq[ inTraining,]
testing  <- ibq[-inTraining,]

fmla <- as.formula(paste("group ~ ", paste(colnames(ibq[c(8:44)]), collapse= "+")))
predictors <- colnames(ibq[c(8:44)])

train_control<- trainControl(method="repeatedcv", savePredictions = "final", classProbs = T, returnResamp='all')

cl <- makePSOCKcluster(10)
registerDoParallel(cl)

fit_rf_control_one_all <- caret::train(fmla, data=training, method="rf", trControl = train_control, importance = TRUE)
fit_lda_control_one_all <- caret::train(fmla, data=training, method="lda", trControl = train_control)
fit_glm_control_one_all <- caret::train(fmla, data=training, method="glm", trControl = train_control)
fit_knn_control_one_all <- caret::train(fmla, data=training, method="knn",trControl = train_control)
fit_nb_control_one_all <- caret::train(fmla, data=training, method="nb", trControl = train_control)
fit_svm_control_one_all <- caret::train(fmla, data=training, method="svmRadial", trControl = train_control)
fit_cart_control_one_all <- caret::train(fmla, data=training, method="rpart", trControl = train_control)
fit_c50_control_one_all <- caret::train(fmla, data=training, method="C5.0", trControl = train_control)
fit_treebag_control_one_all <- caret::train(fmla, data=training, method="treebag", trControl = train_control)
fit_gbm_control_one_all <- caret::train(fmla, data=training, method="gbm", trControl = train_control, verbose = FALSE)
fit_adabag_control_one_all <- caret::train(fmla, data=training, method="AdaBag", trControl = train_control)

## When you are done:
stopCluster(cl)


#infant gender model results

results <- resamples(list(lda=fit_lda_control_one_all, glm=fit_glm_control_one_all, svm=fit_svm_control_one_all, knn=fit_knn_control_one_all, nb=fit_nb_control_one_all, cart=fit_cart_control_one_all, c50=fit_c50_control_one_all,treebag=fit_treebag_control_one_all, rf=fit_rf_control_one_all, gbm=fit_gbm_control_one_all, adabag=fit_adabag_control_one_all))
# Table comparison
#summary(results)

# boxplot comparison
bwplot(results, main = "Model Accuracy Estimates: Chronological Age Group VS. Pre-Term Group - All Variables")
# Dot-plot comparison
#dotplot(results)




```
\newpage

```{r, echo=FALSE, warning = FALSE, message = FALSE, error=FALSE, fig.width = 10.5, fig.height = 7.5, fig.cap=paste("Receiver Operator Curve: Chronological Age Group vs. Pre-Term Group - All Variables.")}

modellist <- c("lda", "glm", "svm", "knn", "nb", "cart", "c50", "treebag", "rf", "gbm", "adabag")
leng <- 1:length(modellist)  
txt <- NULL
txt2 <- NULL
j <- 1
for (i in modellist) {
  modelnumber <- leng[j]
  library("ROCR")
  ### CONSTRUCTING ROC AUC PLOT:
  # Get the posteriors as a dataframe.
  predictions <-predict(object = eval(parse(text=paste("fit_", i, "_control_one_all", sep=""))), testing[,predictors], type = "prob")
  predictions.posteriors <- as.data.frame(predictions)
  
  # Evaluate the model
  pred <- prediction(predictions.posteriors[,2], testing[,3])
  roc.perf = performance(pred, measure = "tpr", x.measure = "fpr")
  auc.train <- performance(pred, measure = "auc")
  auc.train <- auc.train@y.values
  # Plot
  
  par(mar=c(5.1, 4.1, 4.1, 13), xpd=TRUE) 
  
  if(modelnumber == 1) {
    plot(roc.perf, col = j, main = "ROC Curve: Chronological Age Group VS. Pre-Term Group - All Variables", cex.lab = 1.5, cex.main = 1.5)  
    #abline(a=0, b= 1)
    #text(x = .25, y = .65 ,paste("AUC = ", round(auc.train[[1]],3), sep = ""))
  } else{
    plot(roc.perf, col = j, add = TRUE, main = "ROC Curve: Chronological Age Group VS. Pre-Term Group - All Variables", cex.lab = 1.5, cex.main = 1.5)
    #abline(a=0, b= 1)
    
  }
  txt[j] <- paste(i, " AUC = ", round(auc.train[[1]],3), sep = "")
  txt2[j] <- round(auc.train[[1]],3)
  j <- j+1
  
}

legend("bottomright", txt, inset=c(0,0), lty = 1, col = c(1:11), cex = 1.1, xpd=TRUE )


results_one_all <- results
auc_one_all <- txt2

```
\newpage

## Model Development and Output: Adjusted Age Group VS. Pre-Term Group - ALL VARIABLES

```{r, echo=FALSE, warning = FALSE, message = FALSE, error=FALSE, fig.width = 10.5, fig.height = 7.5, fig.cap=paste("Accuracy Estimates: Age Adjusted Group vs. Pre-Term Group - All Variables.")}
set.seed(9999)
library(haven)
library(klaR)
#Infant gender model construction

ibq <- ibq_impute

ibq$group <- as.factor(ibq$group)
ibq$group <- revalue(ibq$group, c("0"="experimental", "1"="control_one", "2"="control_two"))

ibq <- ibq[ibq$group != "control_one",]
ibq$group <- factor(ibq$group)
ibq$group <- relevel(ibq$group, "control_two")

#ibq <- subset(ibq, AgeGrp == "three")

# ibq$infantgender <- as.factor(ibq$infantgender)
# levels(ibq$infantgender) <- c('male', 'female')

set.seed(103)
inTraining <- createDataPartition(ibq$group, p = .7, list = FALSE)
training <- ibq[ inTraining,]
testing  <- ibq[-inTraining,]

fmla <- as.formula(paste("group ~ ", paste(colnames(ibq[c(8:44)]), collapse= "+")))
predictors <- colnames(ibq[c(8:44)])

train_control<- trainControl(method="repeatedcv", savePredictions = "final", classProbs = T, returnResamp='all')

cl <- makePSOCKcluster(10)
registerDoParallel(cl)

fit_rf_control_two_all <- caret::train(fmla, data=training, method="rf", trControl = train_control, importance = TRUE)
fit_lda_control_two_all <- caret::train(fmla, data=training, method="lda", trControl = train_control)
fit_glm_control_two_all <- caret::train(fmla, data=training, method="glm", trControl = train_control)
fit_knn_control_two_all <- caret::train(fmla, data=training, method="knn",trControl = train_control)
fit_nb_control_two_all <- caret::train(fmla, data=training, method="nb", trControl = train_control)
fit_svm_control_two_all <- caret::train(fmla, data=training, method="svmRadial", trControl = train_control)
fit_cart_control_two_all <- caret::train(fmla, data=training, method="rpart", trControl = train_control)
fit_c50_control_two_all <- caret::train(fmla, data=training, method="C5.0", trControl = train_control)
fit_treebag_control_two_all <- caret::train(fmla, data=training, method="treebag", trControl = train_control)
fit_gbm_control_two_all <- caret::train(fmla, data=training, method="gbm", trControl = train_control, verbose = FALSE)
fit_adabag_control_two_all <- caret::train(fmla, data=training, method="AdaBag", trControl = train_control)

## When you are done:
stopCluster(cl)


#infant gender model results

results <- resamples(list(lda=fit_lda_control_two_all, glm=fit_glm_control_two_all, svm=fit_svm_control_two_all, knn=fit_knn_control_two_all, nb=fit_nb_control_two_all, cart=fit_cart_control_two_all, c50=fit_c50_control_two_all,treebag=fit_treebag_control_two_all, rf=fit_rf_control_two_all, gbm=fit_gbm_control_two_all, adabag=fit_adabag_control_two_all))
# Table comparison
#summary(results)

# boxplot comparison
bwplot(results, main = "Model Accuracy Estimates: Adjusted Age Group VS. Pre-Term Group - All Variables")
# Dot-plot comparison
#dotplot(results)




```
\newpage

```{r, echo=FALSE, warning = FALSE, message = FALSE, error=FALSE, fig.width = 10.5, fig.height = 7.5, fig.cap=paste("Receiver Operator Curve: Age Adjusted Group vs. Pre-Term Group - All Variables.")}

modellist <- c("lda", "glm", "svm", "knn", "nb", "cart", "c50", "treebag", "rf", "gbm", "adabag")
leng <- 1:length(modellist)  
txt <- NULL
txt2 <- NULL
j <- 1
for (i in modellist) {
  modelnumber <- leng[j]
  library("ROCR")
  ### CONSTRUCTING ROC AUC PLOT:
  # Get the posteriors as a dataframe.
  predictions <-predict(object = eval(parse(text=paste("fit_", i, "_control_two_all", sep=""))), testing[,predictors], type = "prob")
  predictions.posteriors <- as.data.frame(predictions)
  
  # Evaluate the model
  pred <- prediction(predictions.posteriors[,2], testing[,3])
  roc.perf = performance(pred, measure = "tpr", x.measure = "fpr")
  auc.train <- performance(pred, measure = "auc")
  auc.train <- auc.train@y.values
  # Plot
  
  par(mar=c(5.1, 4.1, 4.1, 13), xpd=TRUE) 
  
  if(modelnumber == 1) {
    plot(roc.perf, col = j, main = "ROC Curve: Adjusted Age Group VS. Pre-Term Group - All Variables", cex.lab = 1.5, cex.main = 1.5)  
    #abline(a=0, b= 1)
    #text(x = .25, y = .65 ,paste("AUC = ", round(auc.train[[1]],3), sep = ""))
  } else{
    plot(roc.perf, col = j, add = TRUE, main = "ROC Curve: Adjusted Age Group VS. Pre-Term Group - All Variables", cex.lab = 1.5, cex.main = 1.5)
    #abline(a=0, b= 1)
    
  }
  txt[j] <- paste(i, " AUC = ", round(auc.train[[1]],3), sep = "")
  txt2[j] <- round(auc.train[[1]],3)
  j <- j+1
  
}

legend("bottomright", txt, inset=c(0,0), lty = 1, col = c(1:11), cex = 1.1, xpd=TRUE )


results_two_all <- results
auc_two_all <- txt2

```

\newpage

## Model Development and Output: Chronological Age Group VS. Pre-Term Group - TRANSFORMED VARIABLES


```{r, echo=FALSE, warning = FALSE, results = 'hide', message = FALSE, error=FALSE, fig.width = 10.5, fig.height = 7.5, fig.cap=paste("Accuracy Estimates: Chronological Age Group vs. Pre-Term Group - Transformed Variables.")}
set.seed(9999)
library(haven)
library(klaR)
#Infant gender model construction

ibq <- ibq_impute

ibq$group <- as.factor(ibq$group)
ibq$group <- revalue(ibq$group, c("0"="experimental", "1"="control_one", "2"="control_two"))

ibq <- ibq[ibq$group != "control_two",]
ibq$group <- factor(ibq$group)
ibq$group <- relevel(ibq$group, "control_one")
#ibq <- subset(ibq, AgeGrp == "three")

# ibq$infantgender <- as.factor(ibq$infantgender)
# levels(ibq$infantgender) <- c('male', 'female')

set.seed(103)
inTraining <- createDataPartition(ibq$group, p = .7, list = FALSE)
training <- ibq[ inTraining,]
testing  <- ibq[-inTraining,]

fmla <- as.formula(paste("group ~ ", paste(colnames(ibq[c(45:47)]), collapse= "+")))
predictors <- colnames(ibq[c(45:47)])

train_control<- trainControl(method="repeatedcv", savePredictions = "final", classProbs = T, returnResamp='all')

cl <- makePSOCKcluster(10)
registerDoParallel(cl)

fit_rf_control_one_trans <- caret::train(fmla, data=training, method="rf", trControl = train_control, importance = TRUE)
fit_lda_control_one_trans <- caret::train(fmla, data=training, method="lda", trControl = train_control)
fit_glm_control_one_trans <- caret::train(fmla, data=training, method="glm", trControl = train_control)
fit_knn_control_one_trans <- caret::train(fmla, data=training, method="knn",trControl = train_control)
fit_nb_control_one_trans <- caret::train(fmla, data=training, method="nb", trControl = train_control)
fit_svm_control_one_trans <- caret::train(fmla, data=training, method="svmRadial", trControl = train_control)
fit_cart_control_one_trans <- caret::train(fmla, data=training, method="rpart", trControl = train_control)
fit_c50_control_one_trans <- caret::train(fmla, data=training, method="C5.0", trControl = train_control)
fit_treebag_control_one_trans <- caret::train(fmla, data=training, method="treebag", trControl = train_control)
fit_gbm_control_one_trans <- caret::train(fmla, data=training, method="gbm", trControl = train_control, verbose = FALSE)
fit_adabag_control_one_trans <- caret::train(fmla, data=training, method="AdaBag", trControl = train_control)

## When you are done:
stopCluster(cl)


#infant gender model results

results <- resamples(list(lda=fit_lda_control_one_trans, glm=fit_glm_control_one_trans, svm=fit_svm_control_one_trans, knn=fit_knn_control_one_trans, nb=fit_nb_control_one_trans, cart=fit_cart_control_one_trans, c50=fit_c50_control_one_trans,treebag=fit_treebag_control_one_trans, rf=fit_rf_control_one_trans, gbm=fit_gbm_control_one_trans, adabag=fit_adabag_control_one_trans))
# Table comparison
#summary(results)

# boxplot comparison
bwplot(results, main = "Model Accuracy Estimates: Chronological Age Group VS. Pre-Term Group - Transformed Variables")
# Dot-plot comparison
#dotplot(results)




```

\newpage

```{r, echo=FALSE, warning = FALSE, message = FALSE, error=FALSE, fig.width = 10.5, fig.height = 7.5, fig.cap=paste("Receiver Operator Curve: Chronological Age Group vs. Pre-Term Group - Transformed Variables.")}

modellist <- c("lda", "glm", "svm", "knn", "nb", "cart", "c50", "treebag", "rf", "gbm", "adabag")
leng <- 1:length(modellist)  
txt <- NULL
txt2 <- NULL
j <- 1
for (i in modellist) {
  modelnumber <- leng[j]
  library("ROCR")
  ### CONSTRUCTING ROC AUC PLOT:
  # Get the posteriors as a dataframe.
  predictions <-predict(object = eval(parse(text=paste("fit_", i, "_control_one_trans", sep=""))), testing[,predictors], type = "prob")
  predictions.posteriors <- as.data.frame(predictions)
  
  # Evaluate the model
  pred <- prediction(predictions.posteriors[,2], testing[,3])
  roc.perf = performance(pred, measure = "tpr", x.measure = "fpr")
  auc.train <- performance(pred, measure = "auc")
  auc.train <- auc.train@y.values
  # Plot
  
  par(mar=c(5.1, 4.1, 4.1, 13), xpd=TRUE) 
  
  if(modelnumber == 1) {
    plot(roc.perf, col = j, main = "ROC Curve: Chronological Age Group VS. Pre-Term Group - Transformed Variables", cex.lab = 1.5, cex.main = 1.5)  
    #abline(a=0, b= 1)
    #text(x = .25, y = .65 ,paste("AUC = ", round(auc.train[[1]],3), sep = ""))
  } else{
    plot(roc.perf, col = j, add = TRUE, main = "ROC Curve: Chronological Age Group VS. Pre-Term Group - Transformed Variables", cex.lab = 1.5, cex.main = 1.5)
    #abline(a=0, b= 1)
    
  }
  txt[j] <- paste(i, " AUC = ", round(auc.train[[1]],3), sep = "")
  txt2[j] <- round(auc.train[[1]],3)
  j <- j+1
  
}

legend("bottomright", txt, inset=c(0,0), lty = 1, col = c(1:11), cex = 1.1, xpd=TRUE )


results_one_trans <- results
auc_one_trans <- txt2

```
\newpage

## Model Development and Output: Adjusted Age Group VS. Pre-Term Group - TRANSFORMED VARIABLES

```{r, echo=FALSE, results = 'hide', warning = FALSE, message = FALSE, error=FALSE, fig.width = 10.5, fig.height = 7.5, fig.cap=paste("Accuracy Estimates: Age Adjusted Group vs. Pre-Term Group - Transformed Variables.")}
set.seed(9999)
library(haven)
library(klaR)
#Infant gender model construction

ibq <- ibq_impute

ibq$group <- as.factor(ibq$group)
ibq$group <- revalue(ibq$group, c("0"="experimental", "1"="control_one", "2"="control_two"))

ibq <- ibq[ibq$group != "control_one",]
ibq$group <- factor(ibq$group)
ibq$group <- relevel(ibq$group, "control_two")

#ibq <- subset(ibq, AgeGrp == "three")

# ibq$infantgender <- as.factor(ibq$infantgender)
# levels(ibq$infantgender) <- c('male', 'female')

set.seed(103)
inTraining <- createDataPartition(ibq$group, p = .7, list = FALSE)
training <- ibq[ inTraining,]
testing  <- ibq[-inTraining,]

fmla <- as.formula(paste("group ~ ", paste(colnames(ibq[c(45:47)]), collapse= "+")))
predictors <- colnames(ibq[c(45:47)])

train_control<- trainControl(method="repeatedcv", savePredictions = "final", classProbs = T, returnResamp='all')

cl <- makePSOCKcluster(10)
registerDoParallel(cl)

fit_rf_control_two_trans <- caret::train(fmla, data=training, method="rf", trControl = train_control, importance = TRUE)
fit_lda_control_two_trans <- caret::train(fmla, data=training, method="lda", trControl = train_control)
fit_glm_control_two_trans <- caret::train(fmla, data=training, method="glm", trControl = train_control)
fit_knn_control_two_trans <- caret::train(fmla, data=training, method="knn",trControl = train_control)
fit_nb_control_two_trans <- caret::train(fmla, data=training, method="nb", trControl = train_control)
fit_svm_control_two_trans <- caret::train(fmla, data=training, method="svmRadial", trControl = train_control)
fit_cart_control_two_trans <- caret::train(fmla, data=training, method="rpart", trControl = train_control)
fit_c50_control_two_trans <- caret::train(fmla, data=training, method="C5.0", trControl = train_control)
fit_treebag_control_two_trans <- caret::train(fmla, data=training, method="treebag", trControl = train_control)
fit_gbm_control_two_trans <- caret::train(fmla, data=training, method="gbm", trControl = train_control, verbose = FALSE)
fit_adabag_control_two_trans <- caret::train(fmla, data=training, method="AdaBag", trControl = train_control)

## When you are done:
stopCluster(cl)


#infant gender model results

results <- resamples(list(lda=fit_lda_control_two_trans, glm=fit_glm_control_two_trans, svm=fit_svm_control_two_trans, knn=fit_knn_control_two_trans, nb=fit_nb_control_two_trans, cart=fit_cart_control_two_trans, c50=fit_c50_control_two_trans,treebag=fit_treebag_control_two_trans, rf=fit_rf_control_two_trans, gbm=fit_gbm_control_two_trans, adabag=fit_adabag_control_two_trans))
# Table comparison
#summary(results)

# boxplot comparison
bwplot(results, main = "Model Accuracy Estimates: Adjusted Age Group VS. Pre-Term Group - Transformed Variables")
# Dot-plot comparison
#dotplot(results)




```


\newpage

```{r, echo=FALSE, warning = FALSE, message = FALSE, error=FALSE, fig.width = 10.5, fig.height = 7.5, fig.cap=paste("Receiver Operator Curve: Age Adjusted Group vs. Pre-Term Group - Transformed Variables.")}

modellist <- c("lda", "glm", "svm", "knn", "nb", "cart", "c50", "treebag", "rf", "gbm", "adabag")
leng <- 1:length(modellist)  
txt <- NULL
txt2 <- NULL
j <- 1
for (i in modellist) {
  modelnumber <- leng[j]
  library("ROCR")
  ### CONSTRUCTING ROC AUC PLOT:
  # Get the posteriors as a dataframe.
  predictions <-predict(object = eval(parse(text=paste("fit_", i, "_control_two_trans", sep=""))), testing[,predictors], type = "prob")
  predictions.posteriors <- as.data.frame(predictions)
  
  # Evaluate the model
  pred <- prediction(predictions.posteriors[,2], testing[,3])
  roc.perf = performance(pred, measure = "tpr", x.measure = "fpr")
  auc.train <- performance(pred, measure = "auc")
  auc.train <- auc.train@y.values
  # Plot
  
  par(mar=c(5.1, 4.1, 4.1, 13), xpd=TRUE) 
  
  if(modelnumber == 1) {
    plot(roc.perf, col = j, main = "ROC Curve: Adjusted Age Group VS. Pre-Term Group - Transformed Variables", cex.lab = 1.5, cex.main = 1.5)  
    #abline(a=0, b= 1)
    #text(x = .25, y = .65 ,paste("AUC = ", round(auc.train[[1]],3), sep = ""))
  } else{
    plot(roc.perf, col = j, add = TRUE, main = "ROC Curve: Adjusted Age Group VS. Pre-Term Group - Transformed Variables", cex.lab = 1.5, cex.main = 1.5)
    #abline(a=0, b= 1)
    
  }
  txt[j] <- paste(i, " AUC = ", round(auc.train[[1]],3), sep = "")
  txt2[j] <- round(auc.train[[1]],3)
  j <- j+1
  
}

legend("bottomright", txt, inset=c(0,0), lty = 1, col = c(1:11), cex = 1.1, xpd=TRUE )


results_two_trans <- results
auc_two_trans <- txt2

```
\newpage

## Feature Importance - Random Forest Model Results: Transformed Variables

```{r, echo=FALSE, warning=FALSE, message=FALSE, fig.width = 10.5, fig.height = 7.5, fig.cap=paste("Feature Importance: Chronological Age Group vs. Pre-Term Group - All Variables.")}

#remove scale = FALSE to address negatives

# p1 <- varImp(fit_rf_control_one_trans, scale = FALSE)$importance
# p1$name <- rownames(p1)
# p2 <- varImp(fit_rf_control_two_trans, scale = FALSE)$importance
# p2$name <- rownames(p2)


p1 <- varImp(fit_rf_control_one_trans,scale = TRUE)[["importance"]]
p1$Overall <- p1$control_one / sum(p1$control_one)
p1$name <- rownames(p1)
p2 <- varImp(fit_rf_control_two_trans,scale = TRUE)[["importance"]]
p2$Overall <- p2$control_two / sum(p2$control_two)
p1$name <- rownames(p2)

p1$name <- c("surgency/positive affectivity", "distress/negative affectivity", "regulation/effortful control")
# p1name <- gsub("^.*?_","",p1$name)
# p1name <- gsub("^.*?_","",p1name)
p1$category <- p1$name
# 
p2$name <- c("surgency/positive affectivity", "distress/negative affectivity", "regulation/effortful control")

# p2name <- gsub("^.*?_","",p2$name)
# p2name <- gsub("^.*?_","",p2name)
p2$category <- p1$name

# p1 <- p1[order(-p1$experimental),]
# p2 <- p2[order(-p2$experimental),]

p1$name <- factor(p1$name, levels = p1$name[order(p1$experimental)])
p2$name <- factor(p2$name, levels = p2$name[order(p2$experimental)])


# p1a <- ggplot(p1) + ggtitle("Random Forest Control One vs. Experimental", subtitle = "Transformed Variables")   + theme_classic(base_size = 17)
# p2a <- ggplot(p2) + ggtitle("Random Forest Control Two vs. Experimental", subtitle = "Transformed Variables")   + theme_classic(base_size = 17)

p1[3,3] <- .01
p2[3,3] <- .006

p1a <- ggplot(p1[1:3,], aes(x=Overall, y=name, fill=category)) + geom_bar(aes(y=name), stat="identity") + ggtitle("Random Forest Chronological Age Group vs. Pre-Term Group", subtitle = "Transformed Variables")   + theme_classic(base_size = 17) + xlab("Importance %") + ylab("Category")
p2a <- ggplot(p2[1:3,], aes(x=Overall, y=name, fill=category)) + geom_bar(aes(y=name), stat="identity") + ggtitle("Random Forest Adjusted Age Group vs. Pre-Term Group", subtitle = "Transformed Variables")   + theme_classic(base_size = 17) + xlab("Importance %") + ylab("Category")


```

\newpage

```{r, echo=FALSE, warning=FALSE, message=FALSE, fig.width = 10.5, fig.height = 7.5, fig.cap=paste("Feature Importance: Chronological Age Group vs. Pre-Term Group - Transformed Variables")}

p1a

```

\newpage

```{r, echo=FALSE, warning=FALSE, message=FALSE, fig.width = 10.5, fig.height = 7.5, fig.cap=paste("Feature Importance: Age Adjusted Group vs. Pre-Term Group - Transformed Variables")}

p2a

```
\newpage

## Feature Importance - Random Forest Model Results: All Variables

```{r, echo=FALSE, warning=FALSE, message=FALSE, fig.width = 10.5, fig.height = 7.5, fig.cap=paste("Feature Importance: Chronological Age Group vs. Pre-Term Group - All Variables")}

# p1 <- varImp(fit_rf_control_one_all, scale = FALSE)$importance
# p1$name <- rownames(p1)
# p2 <- varImp(fit_rf_control_two_all, scale = FALSE)$importance
# p2$name <- rownames(p1)

p1 <- varImp(fit_rf_control_one_all,scale = TRUE)[["importance"]]
p1$Overall <- p1$control_one / sum(p1$control_one)
p1$name <- rownames(p1)
p2 <- varImp(fit_rf_control_two_all,scale = TRUE)[["importance"]]
p2$Overall <- p2$control_two / sum(p2$control_two)
p2$name <- rownames(p2)





p1name <- gsub("^.*?_","",p1$name)
p1name <- gsub("^.*?_","",p1name)
p1$category <- as.factor(p1name)
levels(p1$category) <- c("regulation/effortful control", "distress/negative affectivity", "surgency/positive affectivity" )

p2name <- gsub("^.*?_","",p2$name)
p2name <- gsub("^.*?_","",p2name)
p2$category <- as.factor(p2name)
levels(p2$category) <- c("regulation/effortful control", "distress/negative affectivity", "surgency/positive affectivity" )

# p1 <- p1[order(-p1$experimental),]
# p2 <- p2[order(-p2$experimental),]

p1$name <- factor(p1$name, levels = p1$name[order(p1$experimental)])
p2$name <- factor(p2$name, levels = p2$name[order(p2$experimental)])

p1a <- ggplot(p1[1:20,], aes(x=Overall, y=name, fill=category)) + geom_bar(aes(y=name), stat="identity") + ggtitle("Random Forest Chronological Age Group vs. Pre-Term Group", subtitle = "All Variables")   + theme_classic(base_size = 17)+ xlab("Importance %") + ylab("Questions")
p2a <- ggplot(p2[1:20,], aes(x=Overall, y=name, fill=category)) + geom_bar(aes(y=name), stat="identity") + ggtitle("Random Forest Adjusted Age Group vs. Pre-Term Group", subtitle = "All Variables")   + theme_classic(base_size = 17)+ xlab("Importance %") + ylab("Questions")
#p2a <- ggplot(p2) + ggtitle("Random Forest Control Two vs. Experimental", subtitle = "All Variables")   + theme_classic(base_size = 17)


```

\newpage

```{r, echo=FALSE, warning=FALSE, message=FALSE, fig.width = 10.5, fig.height = 7.5, fig.cap=paste("Feature Importance: Chronological Age Group vs. Pre-Term Group - All Variables")}

p1a

```

\newpage

```{r, echo=FALSE, warning=FALSE, message=FALSE, fig.width = 10.5, fig.height = 7.5, fig.cap=paste("Feature Importance: Age Adjusted Group vs. Pre-Term Group - All Variables")}

p2a

```


```{r, echo=FALSE, warning=FALSE, message=FALSE}
# library(kableExtra)
# 
# results_one_all_b <- as.data.frame(results_one_all$values)
# #colnames(results_gender_b) <- colnames(as.data.frame(results_age$values))
# results_one_all_accuracy <- colMeans(t(results_one_all_b[c(2,4,6,8,10,12,14,16,18,20,22)]))
# results_one_all_kappa <- colMeans((results_one_all_b[c(3,5,7,9,11,13,15,17,19,21,23)]))
# auc_one_all <- auc_one_all[-1]
# one_all <- cbind(results_one_all_accuracy, results_one_all_kappa, auc_one_all)
# rownames(one_all) <- c("lda", "glm", "svm", "knn", "nb", "cart", "c5.0", "bagging", "rf", "gbm", "adabag")
# 
# results_two_all_b <- as.data.frame(results_two_all$values)
# results_two_all_accuracy <- colMeans(t(results_two_all_b[c(2,4,6,8,10,12,14,16,18,20,22)]))
# results_two_all_kappa <- colMeans((results_two_all_b[c(3,5,7,9,11,13,15,17,19,21,23)]))
# auc_two_all <- auc_two_all[-1]
# two_all <- cbind(results_two_all_accuracy, results_two_all_kappa, auc_two_all)
# rownames(two_all) <- c("lda", "glm", "svm", "knn", "nb", "cart", "c5.0", "bagging", "rf", "gbm", "adabag")
# 
# 
# results_one_trans_b <- as.data.frame(results_one_trans$values)
# #colnames(results_one_trans_b) <- colnames(as.data.frame(results_one_trans$values))
# results_one_trans_accuracy <- colMeans(t(results_one_trans_b[c(2,4,6,8,10,12,14,16,18,20,22)]))
# results_one_trans_kappa <- colMeans((results_one_trans_b[c(3,5,7,9,11,13,15,17,19,21,23)]))
# auc_one_trans <- auc_one_trans[-1]
# one_trans <- cbind(results_one_trans_accuracy, results_one_trans_kappa, auc_one_trans)
# rownames(one_trans) <- c("lda", "glm", "svm", "knn", "nb", "cart", "c5.0", "bagging", "rf", "gbm", "adabag")
# 
# results_two_trans_b <- as.data.frame(results_two_trans$values)
# #colnames(results_one_trans_b) <- colnames(as.data.frame(results_one_trans$values))
# results_two_trans_accuracy <- colMeans(t(results_two_trans_b[c(2,4,6,8,10,12,14,16,18,20,22)]))
# results_two_trans_kappa <- colMeans((results_two_trans_b[c(3,5,7,9,11,13,15,17,19,21,23)]))
# auc_two_trans <- auc_two_trans[-1]
# two_trans <- cbind(results_two_trans_accuracy, results_two_trans_kappa, auc_two_trans)
# rownames(two_trans) <- c("lda", "glm", "svm", "knn", "nb", "cart", "c5.0", "bagging", "rf", "gbm", "adabag")

```


```{r, echo=FALSE, warning=FALSE, message=FALSE}
library(kableExtra)


fit_two_trans_R2 <- c(fit_lda_control_two_trans[[4]]$Accuracy, fit_glm_control_two_trans[[4]]$Accuracy, fit_svm_control_two_trans[[4]]$Accuracy[[2]], fit_knn_control_two_trans[[4]]$Accuracy[[3]], fit_nb_control_two_trans[[4]]$Accuracy[[1]], fit_cart_control_two_trans[[4]]$Accuracy[[1]], fit_c50_control_two_trans[[4]]$Accuracy[[1]],fit_treebag_control_two_trans[[4]]$Accuracy[[1]], fit_rf_control_two_trans[[4]]$Accuracy[[1]], fit_gbm_control_two_trans[[4]]$Accuracy[[4]], fit_adabag_control_two_trans[[4]]$Accuracy[[4]])

fit_two_trans_Kappa <- c(fit_lda_control_two_trans[[4]]$Kappa, fit_glm_control_two_trans[[4]]$Kappa, fit_svm_control_two_trans[[4]]$Kappa[[2]], fit_knn_control_two_trans[[4]]$Kappa[[3]], fit_nb_control_two_trans[[4]]$Kappa[[1]], fit_cart_control_two_trans[[4]]$Kappa[[1]], fit_c50_control_two_trans[[4]]$Kappa[[1]],fit_treebag_control_two_trans[[4]]$Kappa[[1]], fit_rf_control_two_trans[[4]]$Kappa[[1]], fit_gbm_control_two_trans[[4]]$Kappa[[4]], fit_adabag_control_two_trans[[4]]$Kappa[[4]])

fit_two_trans_AUC <- auc_two_trans

fit_one_trans_R2 <- c(fit_lda_control_one_trans[[4]]$Accuracy, fit_glm_control_one_trans[[4]]$Accuracy, fit_svm_control_one_trans[[4]]$Accuracy[[2]], fit_knn_control_one_trans[[4]]$Accuracy[[3]], fit_nb_control_one_trans[[4]]$Accuracy[[1]], fit_cart_control_one_trans[[4]]$Accuracy[[1]], fit_c50_control_one_trans[[4]]$Accuracy[[1]],fit_treebag_control_one_trans[[4]]$Accuracy[[1]], fit_rf_control_one_trans[[4]]$Accuracy[[1]], fit_gbm_control_one_trans[[4]]$Accuracy[[4]], fit_adabag_control_one_trans[[4]]$Accuracy[[4]])

fit_one_trans_Kappa <- c(fit_lda_control_one_trans[[4]]$Kappa, fit_glm_control_one_trans[[4]]$Kappa, fit_svm_control_one_trans[[4]]$Kappa[[2]], fit_knn_control_one_trans[[4]]$Kappa[[3]], fit_nb_control_one_trans[[4]]$Kappa[[1]], fit_cart_control_one_trans[[4]]$Kappa[[1]], fit_c50_control_one_trans[[4]]$Kappa[[1]],fit_treebag_control_one_trans[[4]]$Kappa[[1]], fit_rf_control_one_trans[[4]]$Kappa[[1]], fit_gbm_control_one_trans[[4]]$Kappa[[4]], fit_adabag_control_one_trans[[4]]$Kappa[[4]])

fit_one_trans_AUC <- auc_one_trans

fit_one_all_R2 <- c(fit_lda_control_one_all[[4]]$Accuracy, fit_glm_control_one_all[[4]]$Accuracy, fit_svm_control_one_all[[4]]$Accuracy[[2]], fit_knn_control_one_all[[4]]$Accuracy[[3]], fit_nb_control_one_all[[4]]$Accuracy[[1]], fit_cart_control_one_all[[4]]$Accuracy[[1]], fit_c50_control_one_all[[4]]$Accuracy[[1]],fit_treebag_control_one_all[[4]]$Accuracy[[1]], fit_rf_control_one_all[[4]]$Accuracy[[1]], fit_gbm_control_one_all[[4]]$Accuracy[[4]], fit_adabag_control_one_all[[4]]$Accuracy[[4]])

fit_one_all_Kappa <- c(fit_lda_control_one_all[[4]]$Kappa, fit_glm_control_one_all[[4]]$Kappa, fit_svm_control_one_all[[4]]$Kappa[[2]], fit_knn_control_one_all[[4]]$Kappa[[3]], fit_nb_control_one_all[[4]]$Kappa[[1]], fit_cart_control_one_all[[4]]$Kappa[[1]], fit_c50_control_one_all[[4]]$Kappa[[1]],fit_treebag_control_one_all[[4]]$Kappa[[1]], fit_rf_control_one_all[[4]]$Kappa[[1]], fit_gbm_control_one_all[[4]]$Kappa[[4]], fit_adabag_control_one_all[[4]]$Kappa[[4]])

fit_one_all_AUC <- auc_one_all

fit_two_all_R2 <- c(fit_lda_control_two_all[[4]]$Accuracy, fit_glm_control_two_all[[4]]$Accuracy, fit_svm_control_two_all[[4]]$Accuracy[[2]], fit_knn_control_two_all[[4]]$Accuracy[[3]], fit_nb_control_two_all[[4]]$Accuracy[[1]], fit_cart_control_two_all[[4]]$Accuracy[[1]], fit_c50_control_two_all[[4]]$Accuracy[[1]],fit_treebag_control_two_all[[4]]$Accuracy[[1]], fit_rf_control_two_all[[4]]$Accuracy[[1]], fit_gbm_control_two_all[[4]]$Accuracy[[4]], fit_adabag_control_two_all[[4]]$Accuracy[[4]])

fit_two_all_Kappa <- c(fit_lda_control_two_all[[4]]$Kappa, fit_glm_control_two_all[[4]]$Kappa, fit_svm_control_two_all[[4]]$Kappa[[2]], fit_knn_control_two_all[[4]]$Kappa[[3]], fit_nb_control_two_all[[4]]$Kappa[[1]], fit_cart_control_two_all[[4]]$Kappa[[1]], fit_c50_control_two_all[[4]]$Kappa[[1]],fit_treebag_control_two_all[[4]]$Kappa[[1]], fit_rf_control_two_all[[4]]$Kappa[[1]], fit_gbm_control_two_all[[4]]$Kappa[[4]], fit_adabag_control_two_all[[4]]$Kappa[[4]])

fit_two_all_AUC <- auc_two_all

one_trans_combined <- cbind(fit_one_trans_R2, fit_one_trans_Kappa, fit_one_trans_AUC)
two_trans_combined <- cbind(fit_two_trans_R2, fit_two_trans_Kappa, fit_two_trans_AUC)
one_all_combined <- cbind(fit_one_all_R2, fit_one_all_Kappa, fit_one_all_AUC)
two_all_combined <- cbind(fit_two_all_R2, fit_two_all_Kappa, fit_two_all_AUC)

modelnames <- c("lda", "glm", "svm", "knn", "nb", "cart", "c5.0", "bagging", "rf", "gbm", "adabag")

trans_combined_final <- cbind.data.frame(one_trans_combined, two_trans_combined)
all_combined_final <- cbind.data.frame(one_all_combined, two_all_combined)
rownames(all_combined_final) <- modelnames
rownames(trans_combined_final) <- modelnames

#one_two_all <- cbind(one_all, two_all)

```

```{r, echo=FALSE, warning=FALSE, message=FALSE}


colnames(all_combined_final) <- c("accuracy", "kappa", "AUC", "accuracy", "kappa", "AUC")
kable(round(all_combined_final, 3), caption = "Model Results: Transformed Variables") %>%
kable_styling("striped", full_width = F,
                position = "left", font_size = 12) %>%
  add_header_above(c("models" = 1, "Chronological VS. Pre-Term: All Variabes" = 3, "Adjusted Age VS. Pre-Term: All Variables" = 3))

```

\newpage

```{r, echo=FALSE, warning=FALSE, message=FALSE}


colnames(trans_combined_final) <- c("accuracy", "kappa", "AUC", "accuracy", "kappa", "AUC")
kable(round(trans_combined_final, 3), caption = "Model Results: Transformed Variables") %>%
kable_styling("striped", full_width = F,
                position = "left", font_size = 12) %>%
  add_header_above(c("models" = 1, "Chronological VS. Pre-Term: Transformed Variabes" = 3, "Adjusted Age VS. Pre-Term: Transformed Variables" = 3))

```

\newpage

```{r, echo=FALSE, warning=FALSE, message=FALSE}

# 
# R2_long <- melt(R2, id = "modelid")
# AUC_long <- melt(AUC, id = "modelid")
# 
# 
# R2plot <- ggplot(R2_long,            
#                aes(x = modelid,
#                    y = value, 
#                    color = variable)) +  geom_line() + theme_bw() + ylim(0,.75) +
# scale_color_manual(values=c('lightgreen','darkgreen','lightblue','darkblue'))
# R2plot
# 
# AUCplot <- ggplot(AUC_long,            
#                aes(x = modelid,
#                    y = value, 
#                    color = variable)) +  geom_line() + theme_bw() + ylim(0,.75) +
# scale_color_manual(values=c('lightgreen','darkgreen','lightblue','darkblue'))
# AUCplot
# 

```

\newpage

```{r, echo=FALSE, warning=FALSE, message=FALSE, fig.cap=paste("Model Accuracy Estimates: Chronological Age Group VS. Pre-Term Group - All Variables.")}
library(kableExtra)

R2 <- cbind.data.frame(all_combined_final[,c(1,4)], trans_combined_final[,c(1,4)])
#R2$model <- row.names(R2)
#R2$modelid <- c(1:11)
R2$modelname <- c("lda", "glm", "svm", "knn", "nb", "cart", "c5.0", "bagging", "rf", "gbm", "adabag")
colnames(R2) <- c("Chronological Age Group, All Variables", "Age Adjusted Group, All Variables", "Chronological Age Group, Transformed Variables", "Age Adjusted Group, Transformed Variables", "modelname")

AUC <- cbind.data.frame(all_combined_final[,c(3,6)], trans_combined_final[,c(3,6)])
#AUC$model <- row.names(AUC)
#AUC$modelid <- c(1:11)
AUC$modelname <- c("lda", "glm", "svm", "knn", "nb", "cart", "c5.0", "bagging", "rf", "gbm", "adabag")
colnames(AUC) <- c("Chronological Age Group, All Variables", "Age Adjusted Group, All Variables", "Chronological Age Group, Transformed Variables", "Age Adjusted Group, Transformed Variables", "modelname")

R2_long <- melt(R2, id = "modelname")
AUC_long <- melt(AUC, id = "modelname")

names(R2_long)[names(R2_long) == 'variable'] <- 'Legend'
names(AUC_long)[names(AUC_long) == 'variable'] <- 'Legend'


```


```{r, echo=FALSE, warning=FALSE, message=FALSE, fig.cap=paste("R2 Comparisons - Chronological Age Group VS Pre-Term Group, Transformed Variables VS. All Variables.")}
library(kableExtra)

R2plot_all <- ggplot(R2_long[c(1:11, 23:33),],            
               aes(x = modelname,
                   y = value, group = Legend)) +  geom_line(aes(linetype=Legend, color=Legend), lwd=1.75) + theme_bw() + ylim(.2,.75) +
scale_color_manual(values=c('lightgreen','darkgreen'))+theme(text=element_text(size=24))+ theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1, size=18))+labs(y= "R2 Value", x = "Model Type", title="R2 Chronological Age Model Comparisons", subtitle="Transformed vs All")+ theme(legend.position="bottom", legend.box="vertical") + guides(color = guide_legend(nrow = 2)) + 
    theme(legend.key.width = unit(5, "line"))
R2plot_all

```

```{r, echo=FALSE, warning=FALSE, message=FALSE, fig.cap=paste("AUC Comparisons - Chronological Age Group VS Pre-Term Group, Transformed Variables VS. All Variables.")}
library(kableExtra)

AUCplot_all <- ggplot(AUC_long[c(1:11, 23:33),],            
               aes(x = modelname,
                   y = value, group = Legend)) +  geom_line(aes(linetype=Legend, color=Legend), lwd=1.75) + theme_bw() + ylim(.2,.75) +
scale_color_manual(values=c('lightgreen','darkgreen'))+theme(text=element_text(size=24))+ theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1, size=18))+labs(y= "AUC Value", x = "Model Type", title="AUC Chronological Age Model Comparisons", subtitle="Transformed vs All")+ theme(legend.position="bottom", legend.box="vertical") + guides(color = guide_legend(nrow = 2)) + 
    theme(legend.key.width = unit(5, "line"))
AUCplot_all

```

```{r, echo=FALSE, warning=FALSE, message=FALSE, fig.cap=paste("R2 Comparisons - Age Adjusted Group VS Pre-Term Group, Transformed Variables VS. All Variables.")}
library(kableExtra)

R2plot_trans <- ggplot(R2_long[c(12:22, 34:44),],            
               aes(x = modelname,
                   y = value, group = Legend)) +  geom_line(aes(linetype=Legend, color=Legend), lwd=1.75) + theme_bw() + ylim(.2,.75) +
scale_color_manual(values=c('lightblue','darkblue'))+theme(text=element_text(size=24))+ theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1, size=18))+labs(y= "R2 Value", x = "Model Type", title="R2 Adjusted Age Model Comparisons", subtitle="Transformed vs All")+ theme(legend.position="bottom", legend.box="vertical") + guides(color = guide_legend(nrow = 2)) + 
    theme(legend.key.width = unit(5, "line"))
R2plot_trans

```

```{r, echo=FALSE, warning=FALSE, message=FALSE, fig.cap=paste("AUC Comparisons - Age Adjusted Group VS Pre-Term Group, Transformed Variables VS. All Variables.")}
library(kableExtra)

AUCplot_trans <- ggplot(AUC_long[c(12:22, 34:44),],            
               aes(x = modelname,
                   y = value, group = Legend)) +  geom_line(aes(linetype=Legend, color=Legend), lwd=1.75) + theme_bw() + ylim(.2,.75) +
scale_color_manual(values=c('lightblue','darkblue'))+theme(text=element_text(size=24))+ theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1, size=18))+labs(y= "AUC Value", x = "Model Type", title="AUC Adjusted Age Model Comparisons", subtitle="Transformed vs All")+ theme(legend.position="bottom", legend.box="vertical") + guides(color = guide_legend(nrow = 2)) + 
    theme(legend.key.width = unit(5, "line"))
AUCplot_trans

# R2plot <- ggplot(R2_long,            
#                aes(x = modelname,
#                    y = value, group = Legend)) +  geom_line(aes(linetype=Legend, color=Legend), lwd=1.75) + theme_bw() + ylim(.2,.75) +
# scale_color_manual(values=c('lightgreen','darkgreen','lightblue','darkblue'))+theme(text=element_text(size=24))+ theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1, size=18))+labs(y= "R2 Value", x = "Model Type", title="R2 All Model Comparisons", subtitle="Transformed vs All")+ theme(legend.position="bottom", legend.box="vertical") + guides(color = guide_legend(nrow = 4)) + 
#     theme(legend.key.width = unit(5, "line"))
# R2plot
# 
# AUCplot <- ggplot(AUC_long,            
#                aes(x = modelname,
#                    y = value, group = Legend)) +  geom_line(aes(linetype=Legend, color=Legend), lwd=1.75) + theme_bw() + ylim(.2,.75) +
# scale_color_manual(values=c('lightgreen','darkgreen','lightblue','darkblue'))+theme(text=element_text(size=24))+ theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1, size=18))+labs(y= "AUC Value", x = "Model Type", title="AUC All Model Comparisons", subtitle="Transformed vs All")+ theme(legend.position="bottom", legend.box="vertical") + guides(color = guide_legend(nrow = 4)) + 
#     theme(legend.key.width = unit(5, "line"))
# AUCplot

```

